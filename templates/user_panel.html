<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kullanıcı Paneli</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <style>
        .container { max-width: 100%; padding: 15px; margin-top: 20px; }
        .info-panel, .form-panel { padding: 15px; border-radius: 8px; }
        .info-panel { background: #f8f9fa; margin-bottom: 15px; }
        .form-panel { background: #ffffff; }
        @media (min-width: 768px) {
            .info-panel { width: 30%; float: left; margin-right: 15px; }
            .form-panel { width: calc(70% - 15px); float: right; }
        }
        .clear { clear: both; }
        #descriptionModal .modal-content { border-radius: 10px; }
        #descriptionModal .modal-header { background: #007bff; color: white; }
        #descriptionModal .modal-footer .btn { margin: 0 5px; }
        #alertModal .modal-header { background: #dc3545; color: white; } /* Hata için kırmızı */
        #alertModal.success .modal-header { background: #28a745; color: white; } /* Başarı için yeşil */
    </style>
</head>
<body>
    <div class="container">
        <h2 class="text-center mb-4">Kullanıcı Paneli</h2>
        <div class="info-panel">
            <p><strong>Email:</strong> {{ email }}</p>
            <p><strong>Plan:</strong> {{ plan }}</p>
            <p><strong>Kalan Limit:</strong> {{ remaining }}</p>
            <a href="/api-management" class="btn btn-info mt-3 w-100">API Yönetimi</a>
            <a href="/logout" class="btn btn-danger mt-3 w-100">Çıkış Yap</a>
        </div>
        <div class="form-panel">
            <h4 class="mb-4">Ürün Açıklama Oluştur</h4>
            <form id="generateForm">
                <div class="mb-3">
                    <label for="product_name" class="form-label">Ürün Adı</label>
                    <input type="text" class="form-control" id="product_name" required>
                </div>
                <div class="mb-3">
                    <label for="category" class="form-label">Kategori</label>
                    <input type="text" class="form-control" id="category" required>
                </div>
                <div class="mb-3">
                    <label for="audience" class="form-label">Hedef Kitle</label>
                    <input type="text" class="form-control" id="audience" required>
                </div>
                <div class="mb-3">
                    <label for="material" class="form-label">Malzeme</label>
                    <input type="text" class="form-control" id="material" required>
                </div>
                <div class="mb-3">
                    <label for="usage" class="form-label">Kullanım</label>
                    <input type="text" class="form-control" id="usage" required>
                </div>
                <div class="mb-3">
                    <label for="platform" class="form-label">Platform</label>
                    <input type="text" class="form-control" id="platform" required>
                </div>
                <button type="submit" class="btn btn-primary w-100" id="submitBtn">
                    Açıklama Oluştur
                    <span class="spinner-border spinner-border-sm ms-2 d-none" role="status" aria-hidden="true" id="loadingSpinner"></span>
                </button>
            </form>
        </div>
        <div class="clear"></div>
    </div>

    <!-- Description Modal -->
    <div class="modal fade" id="descriptionModal" tabindex="-1" aria-labelledby="descriptionModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="descriptionModalLabel">Ürün Açıklaması</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="modalDescription"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
                    <button type="button" class="btn btn-primary" id="copyButton">Kopyala</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Alert Modal -->
    <div class="modal fade" id="alertModal" tabindex="-1" aria-labelledby="alertModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="alertModalLabel">Bildirim</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="alertModalBody"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
    <script>
        
        document.getElementById('generateForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const spinner = document.getElementById('loadingSpinner');
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            spinner.classList.remove('d-none'); // Spinner'ı göster

            const data = {
                product_name: document.getElementById('product_name').value,
                category: document.getElementById('category').value,
                audience: document.getElementById('audience').value,
                material: document.getElementById('material').value,
                usage: document.getElementById('usage').value,
                platform: document.getElementById('platform').value
            };

            try {
                const response = await fetch('/generate-description', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await response.json();

                const alertModal = new bootstrap.Modal(document.getElementById('alertModal'));
                if (result.description) {
                    document.getElementById('modalDescription').textContent = result.description;
                    const descriptionModal = new bootstrap.Modal(document.getElementById('descriptionModal'));
                    descriptionModal.show();
                    document.getElementById('alertModalBody').textContent = "Açıklama başarıyla oluşturuldu!";
                    alertModal._element.classList.add('success');
                } else {
                    document.getElementById('alertModalBody').textContent = result.error || "Bir hata oluştu";
                    alertModal._element.classList.remove('success');
                }
                alertModal.show();
                alertModal._element.addEventListener('hidden.bs.modal', () => {
                    alertModal._element.classList.remove('success');
                });
            } catch (error) {
                console.error("İstek hatası:", error);
                document.getElementById('alertModalBody').textContent = "Sunucuya ulaşılamadı.";
                new bootstrap.Modal(document.getElementById('alertModal')).show();
            } finally {
                submitBtn.disabled = false;
                spinner.classList.add('d-none'); // Spinner'ı gizle
            }
        });


        document.getElementById('copyButton').addEventListener('click', () => {
            const description = document.getElementById('modalDescription').textContent;
            navigator.clipboard.writeText(description).then(() => {
                const alertModal = new bootstrap.Modal(document.getElementById('alertModal'));
                const alertModalEl = document.getElementById('alertModal');
                document.getElementById('alertModalBody').textContent = "Açıklama panoya kopyalandı!";
                alertModalEl.classList.add('success');
                alertModal.show();

                alertModalEl.addEventListener('hidden.bs.modal', () => {
                    alertModalEl.classList.remove('success');
                });
            });
        });
    </script>
</body>
</html>